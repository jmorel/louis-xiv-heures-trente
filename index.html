<html>
<head>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<canvas id="clock" width="600" height="600"></canvas>
<div id="debug">
    <h1>DEBUG</h1>
    <table>
        <tr>
            <th>
                Time
            </th>
            <td colspan="2">
                <select id="debug-hour">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                </select>
                hours
            </td>
        </tr>
        <tr>
            <th>Dimensions</th>
            <td>width: <input id="debug-width" type="number">px</td>
            <td>height: <span id="debug-height"></span>px</td>
        </tr>
        <tr>
            <th>Position</th>
            <td>X: <input id="debug-x" type="number">px</td>
            <td>Y: <input id="debug-y" type="number">px</td>
        </tr>
    </table>
</div>

<h1>Louis XIV-heures-trente</h1>

<p>Une horloge avec des puissants</p>

<script type="text/javascript" src="jquery-2.1.4.min.js"></script>
<script type="text/javascript">
    var clock = document.getElementById('clock');
    var ctx = clock.getContext("2d");

    // debug mode
    var DEBUG = false;
    var $hourSelect = $("#debug-hour");
    var $widthInput = $("#debug-width");
    var $heightSpan = $("#debug-height");
    var $xPositionInput = $("#debug-x");
    var $yPositionInput = $("#debug-y");

    var resetDebug = function () {
        var image = images[$hourSelect.val()];
        if (!image.img) {
            image.img = new Image();
            image.img.onload = function () {
                image.loaded = true;
                resetDebug();
            };
            image.img.src = image.source;
        } else {
            $widthInput.val(image.width);
            updateHeight();
            $xPositionInput.val(image.position.x);
            $yPositionInput.val(image.position.y);
        }
    };

    var updateHeight = function () {
        var image = images[$hourSelect.val()];
        $heightSpan.text(Math.round(image.img.height * parseFloat($widthInput.val()) / image.img.width));
    };

    var enableDebug = function () {
        DEBUG = true;
        var now = new Date();
        $hourSelect.val(now.getHours() % 12);
        resetDebug();
        $hourSelect.on('change', resetDebug);
        $widthInput.on('change', updateHeight);
        $('#debug').show();
    };

    var disableDebug = function () {
        DEBUG = false;
        $('#debug').hide();
    };

    // clock
    var images = [{
        source: 'img/12.jpg',
        position: {
            x: -105,
            y: -50
        },
        width: 400,
        loaded: false
    }, {
        source: 'img/12.jpg',
        position: {
            x: 0,
            y: 0
        },
        width: 400,
        loaded: false
    }, {
        source: 'img/2.jpg',
        position: {
            x: 70,
            y: 20
        },
        width: 600,
        loaded: false
    }, {
        source: 'img/3.jpg',
        position: {
            x: 90,
            y: -107
        },
        width: 900,
        loaded: false
    }, {
        source: 'img/4.jpg',
        position: {
            x: -80,
            y: 80
        },
        width: 500,
        loaded: false
    }, {
        source: 'img/12.jpg',
        position: {
            x: 0,
            y: 0
        },
        width: 400,
        loaded: false
    }, {
        source: 'img/6-fullres.jpg',
        position: {
            x: 5,
            y: 80
        },
        width: 500,
        loaded: false
    }, {
        source: 'img/12.jpg',
        position: {
            x: 0,
            y: 0
        },
        width: 400,
        loaded: false
    }, {
        source: 'img/8.jpg',
        position: {
            x: 60,
            y: 40
        },
        width: 500,
        loaded: false
    }, {
        source: 'img/9.png',
        position: {
            x: -115,
            y: 15
        },
        width: 900,
        loaded: false
    }, {
        source: 'img/12.jpg',
        position: {
            x: 0,
            y: 0
        },
        width: 400,
        loaded: false
    }, {
        source: 'img/11.jpg',
        position: {
            x: -70,
            y: 100
        },
        width: 500,
        loaded: false
    }];

    var center = {x: 300, y: 300};
    var radius = 250;

    var drawImage = function (now) {
        var image = images[DEBUG ? $('#debug-hour').val() : now.getHours() % 12];
        if (!image.img) {
            image.img = new Image();
            image.img.src = image.source;
        }
        if (DEBUG) {
            ctx.drawImage(image.img,
                    center.x + parseFloat($xPositionInput.val()) - parseFloat($widthInput.val()) / 2,
                    center.y + parseFloat($yPositionInput.val()) - parseFloat($heightSpan.text()) / 2,
                    $widthInput.val(),
                    $heightSpan.text());
        } else {
            image.height = image.img.height * image.width / image.img.width;
            ctx.drawImage(image.img,
                    center.x + image.position.x - image.width / 2,
                    center.y + image.position.y - image.height / 2,
                    image.width,
                    image.height);
        }
    };
    var drawClock = function (now) {
        // draw clock disk
        ctx.beginPath();
        ctx.arc(center.x, center.y, radius, 0, 2 * Math.PI, false);
        ctx.fillStyle = 'rgba(236, 129, 9, 0.2)';
        ctx.fill();
        ctx.closePath();

        // 3 - 6 - 9 - 12
        for (var i = 0; i < 4; i++) {
            ctx.beginPath();
            ctx.moveTo(
                    center.x + (radius - 30) * Math.cos(i * Math.PI / 2),
                    center.y + (radius - 30) * Math.sin(i * Math.PI / 2));
            ctx.lineTo(
                    center.x + (radius + 30) * Math.cos(i * Math.PI / 2),
                    center.y + (radius + 30) * Math.sin(i * Math.PI / 2));
            ctx.lineWidth = 19;
            ctx.strokeStyle = 'rgba(236, 129, 9, 1)';
            ctx.stroke();
            ctx.closePath();
        }

        // 1 - 2 - 4 - 5 - 7 - 8 - 10 - 11
        for (var i = 0; i < 4; i++) {
            for (var j = 1; j < 3; j++) {
                ctx.beginPath();
                ctx.moveTo(
                        center.x + (radius - 50) * Math.cos((i * 3 + j) * Math.PI / 6),
                        center.y + (radius - 50) * Math.sin((i * 3 + j) * Math.PI / 6));
                ctx.lineTo(
                        center.x + (radius + 50) * Math.cos((i * 3 + j) * Math.PI / 6),
                        center.y + (radius + 50) * Math.sin((i * 3 + j) * Math.PI / 6));
                ctx.lineWidth = 3;
                ctx.strokeStyle = 'rgba(236, 129, 9, 1)';
                ctx.stroke();
                ctx.closePath();
            }
        }

        // draw minutes
        for (var i = 0; i <= now.getMinutes(); i++) {
            ctx.beginPath();
            ctx.arc(
                    center.x + radius * Math.cos(i * 2 * Math.PI / 60 - Math.PI / 2),
                    center.y + radius * Math.sin(i * 2 * Math.PI / 60 - Math.PI / 2),
                    3,
                    0,
                    Math.PI * 2,
                    true);
            ctx.lineWidth = 2;
            ctx.fill();
            ctx.stroke();
            ctx.closePath();
        }
        // draw seconds
        ctx.beginPath();
        ctx.arc(center.x, center.y, radius, -Math.PI / 2, now.getSeconds() * 2 * Math.PI / 60 - Math.PI / 2);
        ctx.lineWidth = 1;
        ctx.stroke();
        ctx.closePath();
    };

    var clockWork = function () {
        var now = new Date();

        ctx.clearRect(0, 0, clock.width, clock.height);
        drawImage(now);
        drawClock(now);

        setTimeout(clockWork, 500);
    };

    var resizeClock = function () {
        clock.width = $(window).width();
        clock.height = $(window).height();
        center.x = Math.ceil(clock.width / 2);
        center.y = Math.ceil(clock.height / 2);
    };

    $(window).on('resize', resizeClock);

    // init
    resizeClock();
    clockWork();
</script>
</body>
</html>